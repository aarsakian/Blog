sudo: false
language: python
virtualenv:
  system_site_packages: true
python:
- '2.7'

cache:
  directories:
  - "$HOME/google_app_engine/"

env:
- API_CHECK=https://appengine.google.com/api/updatecheck
- FLASK_CONF=TEST 

before_script:
# Idea from https://blog.bekt.net/p/gae-sdk/ retrieve GAE SDK
- SDK_VERSION=$(curl -s $API_CHECK | awk -F '\"' '/release/ {print $2}')
- SDK_URL=https://storage.googleapis.com/appengine-sdks/featured/google_appengine_$SDK_VERSION.zip
- wget $SDK_URL -nv
- unzip -q google_appengine_$SDK_VERSION.zip

before_install:
# Decrypt the credentials we added to the repo using the key we added with the Travis command line tool
- openssl aes-256-cbc -K $encrypted_ec4638b67c22_key -iv $encrypted_ec4638b67c22_iv
  -in credentials.tar.gz.enc -out credentials.tar.gz -d
- tar -xzf credentials.tar.gz
- mkdir -p lib

install:
# install dependencies
- pip install -r requirements.txt -t lib/
- pip install -r test_requirements.txt
  
script:
#RUN THE TESTS
- nosetests --with-coverage --with-gae  --gae-lib-root=google_appengine   --cover-package=blog   tests/test_*
after_success:
- codecov
